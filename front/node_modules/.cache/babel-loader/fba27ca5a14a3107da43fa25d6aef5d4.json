{"ast":null,"code":"var _jsxFileName = \"/Users/maelyschassin/Desktop/HETIC/Front end/imdb_app/front/src/Components/formLogin.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport useCookies from \"../Hooks/getCookies.tsx\";\nimport useRegister from \"../Hooks/register.tsx\";\nimport useLogin from \"../Hooks/login.tsx\";\nimport userLogged from '../Hooks/userLogged.tsx';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function FormLogin(LoginFormPropsInterface) {\n  _s();\n\n  const login = useLogin();\n  const register = useRegister();\n  const cookies = useCookies();\n  console.log('logged', userLogged());\n  const [loggedUser, setLoggedUser] = useState({\n    status: 'error',\n    token: \"\",\n    email: \"\"\n  });\n  const [localUser, setLocalUser] = useState({\n    email: \"\",\n    password: \"\"\n  });\n  const [needsLogin, setNeedsLogin] = useState(true);\n  const [needsUpdate, setNeedsUpdate] = useState(false);\n  const [formInput, setFormInput] = useState({\n    email: \"\",\n    password: \"\"\n  });\n  useEffect(() => {\n    console.log(\"cookies\", cookies);\n\n    if (Object.keys(cookies).includes('hetic_token') && Object.keys(cookies).includes('hetic_email')) {\n      console.log('got cookies !', loggedUser);\n      setLoggedUser(prev => ({ ...prev,\n        email: cookies.hetic_email,\n        token: cookies.hetic_token\n      }));\n    }\n  }, [loggedUser]);\n  useEffect(() => {\n    if (needsLogin && localUser.email !== '') {\n      console.log('login ?');\n      login(localUser.email, localUser.password).then(data => {\n        setLoggedUser(data);\n\n        if (data.status !== 'error') {\n          window.location.href = \"http://localhost:3001/\";\n        } else {\n          alert(data.message);\n        }\n      });\n    } else if (!needsLogin && localUser.email !== '') {\n      console.log('register ?', localUser.email);\n      register(localUser.email, localUser.password).then(data => {\n        setLoggedUser(data);\n        console.log(data);\n\n        if (data.status !== 'error') {\n          setNeedsLogin(true);\n          setFormInput({\n            email: \"\",\n            password: \"\"\n          });\n        } else {\n          alert(data.message);\n        }\n      });\n    }\n  }, [localUser]);\n\n  const handleChange = _ref => {\n    let {\n      target\n    } = _ref;\n    setFormInput(prev => ({ ...prev,\n      [target.name]: target.value\n    }));\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    setLocalUser(formInput);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    className: \"mx-auto\",\n    style: {\n      maxWidth: '350px'\n    },\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"mb-3 text-center\",\n      children: needsLogin ? 'Please Log In' : 'Please Register'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-floating mb-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        id: \"floatingInput\",\n        placeholder: \"FrancisHuster\",\n        name: \"email\",\n        onChange: handleChange,\n        value: formInput.email\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"floatingInput\",\n        children: \"Email\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-3 form-floating\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        className: \"form-control\",\n        id: \"floatingPassword\",\n        placeholder: \"Password\",\n        name: \"password\",\n        onChange: handleChange,\n        value: formInput.password\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"floatingPassword\",\n        children: \"Password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"submit\",\n      className: \"btn btn-primary w-100\",\n      children: needsLogin ? 'Login' : 'Register'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-warning mt-3 w-100\",\n      onClick: () => setNeedsLogin(!needsLogin),\n      children: [needsLogin ? 'Register' : 'Login', \" instead ?\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 9\n  }, this);\n}\n\n_s(FormLogin, \"toQh56mIjkynt0OcSlLjn4Hot1s=\", false, function () {\n  return [useLogin, useRegister, useCookies];\n});\n\n_c = FormLogin;\n\nvar _c;\n\n$RefreshReg$(_c, \"FormLogin\");","map":{"version":3,"names":["React","useState","useEffect","useCookies","useRegister","useLogin","userLogged","FormLogin","LoginFormPropsInterface","login","register","cookies","console","log","loggedUser","setLoggedUser","status","token","email","localUser","setLocalUser","password","needsLogin","setNeedsLogin","needsUpdate","setNeedsUpdate","formInput","setFormInput","Object","keys","includes","prev","hetic_email","hetic_token","then","data","window","location","href","alert","message","handleChange","target","name","value","handleSubmit","e","preventDefault","maxWidth"],"sources":["/Users/maelyschassin/Desktop/HETIC/Front end/imdb_app/front/src/Components/formLogin.tsx"],"sourcesContent":["import React, {useState, useEffect} from \"react\"\nimport useCookies from \"../Hooks/getCookies.tsx\";\nimport useRegister from \"../Hooks/register.tsx\";\nimport useLogin from \"../Hooks/login.tsx\";\nimport {LocalUserInterface} from \"../Interface/LocalUserInterface\";\nimport {LoginResponseInterface} from \"../Interface/ResponsesInterfaces\";\nimport userLogged from '../Hooks/userLogged.tsx'\n\n\n\ninterface LoginFormPropsInterface {\n    setLocalUser: React.Dispatch<LocalUserInterface>,\n    needsLogin: boolean,\n    setNeedsLogin: React.Dispatch<boolean>\n}\n\nexport default function FormLogin(LoginFormPropsInterface){\n\n  const login = useLogin();\n  const register = useRegister();\n  const cookies = useCookies();\n  console.log('logged', userLogged()); \n\n\n  const [loggedUser, setLoggedUser] = useState<LoginResponseInterface>({\n        status: 'error',\n        token: \"\",\n        email: \"\"\n  })\n\n  const [localUser, setLocalUser] = useState<LocalUserInterface>({email: \"\", password: \"\"})\n  const [needsLogin, setNeedsLogin] = useState<boolean>(true)\n  const [needsUpdate, setNeedsUpdate] = useState<boolean>(false)\n\n  const [formInput, setFormInput] = useState<LocalUserInterface>({email: \"\", password: \"\"})\n\n    useEffect(() => {\n      console.log(\"cookies\", cookies);\n          if (Object.keys(cookies).includes('hetic_token') && Object.keys(cookies).includes('hetic_email')) {\n              console.log('got cookies !', loggedUser)\n              setLoggedUser(prev => ({\n                  ...prev,\n                  email: cookies.hetic_email,\n                  token: cookies.hetic_token\n              }))\n          }\n      }, [loggedUser])\n\n      useEffect(() => {\n\n            if (needsLogin && localUser.email !== '') {\n                console.log('login ?')\n                login(localUser.email, localUser.password)\n                    .then(data => {\n                        setLoggedUser(data);\n                        if(data.status !== 'error'){\n                          window.location.href = \"http://localhost:3001/\"\n                        }else{\n                          alert(data.message);\n                        }\n                    })\n            } else if (!needsLogin && localUser.email !== '') {\n                console.log('register ?', localUser.email)\n                register(localUser.email, localUser.password)\n                    .then(data => {\n                      setLoggedUser(data);\n                      console.log(data);\n                      if(data.status !== 'error'){\n                        setNeedsLogin(true);\n                        setFormInput({email: \"\", password: \"\"})\n                      }else{\n                        alert(data.message);\n                      }\n\n                    })\n            }\n        }, [localUser])\n\n\n        const handleChange = ({target}: any) => {\n            setFormInput(prev => ({\n                ...prev,\n                [target.name]: target.value\n            }))\n        }\n\n        const handleSubmit = (e: any) => {\n            e.preventDefault();\n            setLocalUser(formInput);\n        }\n\n\n\n    return (\n        <form className='mx-auto' style={{maxWidth: '350px'}} onSubmit={handleSubmit}>\n            <h2 className='mb-3 text-center'>{needsLogin ? 'Please Log In' : 'Please Register'}</h2>\n            <div className=\"form-floating mb-3\">\n                <input type=\"text\" className=\"form-control\" id=\"floatingInput\" placeholder=\"FrancisHuster\"\n                       name='email' onChange={handleChange} value={formInput.email}/>\n                <label htmlFor=\"floatingInput\">Email</label>\n            </div>\n            <div className=\"mb-3 form-floating\">\n                <input type=\"password\" className=\"form-control\" id=\"floatingPassword\" placeholder=\"Password\"\n                       name='password' onChange={handleChange} value={formInput.password}/>\n                <label htmlFor=\"floatingPassword\">Password</label>\n            </div>\n            <button type='submit' className='btn btn-primary w-100'>{needsLogin ? 'Login' : 'Register'}</button>\n            <button className='btn btn-warning mt-3 w-100'\n                    onClick={() => setNeedsLogin(!needsLogin)}>{needsLogin ? 'Register' : 'Login'} instead ?</button>\n        </form>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}